<?php
session_start();
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Community Board - Home</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
/* ===== YOUR ORIGINAL DESIGN (UNCHANGED) ===== */
:root {
    --bg-gradient: linear-gradient(135deg, #dcf8c6 0%, #f0f2f5 100%);
    --glass-bg: rgba(255,255,255,0.65);
    --glass-sidebar: rgba(62,98,72,0.85);
    --glass-border: 1px solid rgba(255,255,255,0.5);
    --text-main:#111b21;
    --text-muted:#54656f;
    --accent:#3e6248;
    --shadow:0 8px 32px rgba(31,38,135,0.15);
}
body.dark-mode {
    --bg-gradient: linear-gradient(135deg,#0b141a,#202c33);
    --glass-bg: rgba(32,44,51,.75);
    --glass-sidebar: rgba(17,27,33,.85);
    --glass-border:1px solid rgba(255,255,255,.08);
    --text-main:#e9edef;
    --accent:#00a884;
}
*{box-sizing:border-box}
body{
    margin:0;font-family:'Segoe UI',sans-serif;
    background:var(--bg-gradient);color:var(--text-main);
    display:flex;height:100vh;overflow:hidden
}
.sidebar{
    width:260px;background:var(--glass-sidebar);color:#fff;
    padding:20px 0
}
.brand{padding:0 24px;font-weight:bold;font-size:1.2em;margin-bottom:30px}
.menu-item{
    padding:12px 24px;color:rgba(255,255,255,.7);
    text-decoration:none;display:block;border-left:4px solid transparent
}
.menu-item:hover,.menu-item.active{
    background:rgba(255,255,255,.15);color:#fff;border-left:4px solid #fff
}
.main-content{flex:1;overflow-y:auto}
.top-bar{
    height:70px;background:var(--glass-bg);
    display:flex;align-items:center;padding:0 30px
}
.container{padding:30px;max-width:1200px;margin:auto}
.card{
    background:var(--glass-bg);border-radius:16px;
    padding:25px;margin-bottom:20px;box-shadow:var(--shadow)
}
.alert-banner{
    background:linear-gradient(135deg,var(--accent),#2e4c3b);
    color:#fff;padding:15px;border-radius:12px;
    margin-bottom:20px;display:none;
    justify-content:space-between;align-items:center
}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;text-align:left}
th{color:var(--text-muted)}
.badge{
    padding:4px 8px;border-radius:4px;font-size:.75em;font-weight:bold
}
.high{background:#ef5350;color:#fff}
.low{background:#00a884;color:#fff}
.btn-link{color:var(--accent);font-weight:bold;text-decoration:none}
</style>
</head>

<body>

<div class="sidebar">
    <div class="brand"><i class="fas fa-building"></i> CNBS Portal</div>
    <a class="menu-item active" href="landing_page.php">Home</a>
    <a class="menu-item" href="notice_detail.html?id=${n.notice_id}">All Notices</a>
    <a class="menu-item" href="logout.php">Logout</a>
</div>

<div class="main-content">

<div class="top-bar">
    Welcome, <?= htmlspecialchars($_SESSION['username'] ?? 'Guest') ?>
</div>

<div class="container">

<!-- ===== SYSTEM BANNER ===== -->
<div class="alert-banner" id="banner">
    <div>
        <i class="fas fa-bullhorn"></i>
        <b>ANNOUNCEMENT:</b>
        <span id="bannerText"></span>
    </div>
    <span style="cursor:pointer" onclick="this.parentElement.style.display='none'">&times;</span>
</div>

<!-- ===== LATEST NOTICES ===== -->
<div class="card">
<h3>Latest Announcements</h3>
<table>
<thead>
<tr>
<th>Date</th>
<th>Category</th>
<th>Title</th>
<th>Priority</th>
<th>Action</th>
</tr>
</thead>
<tbody id="noticeBody">
<tr><td colspan="5">Loading...</td></tr>
</tbody>
</table>
</div>

</div>
</div>

<script>
/* ===== THEME ===== */
if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark-mode");
}

/* ===== LOAD BANNER ===== */
fetch("api/get_banner.php")
.then(res=>res.json())
.then(data=>{
    if(data.status==="active" && data.text){
        document.getElementById("bannerText").innerText=data.text;
        document.getElementById("banner").style.display="flex";
    }
});

/* ===== LOAD NOTICES ===== */
fetch("api/get_latest_notices.php")
.then(res=>res.json())
.then(list=>{
    const tbody=document.getElementById("noticeBody");
    tbody.innerHTML="";
    if(!list.length){
        tbody.innerHTML="<tr><td colspan='5'>No notices</td></tr>";
        return;
    }
    list.forEach(n=>{
        tbody.innerHTML+=`
        <tr>
            <td>${n.notice_date}</td>
            <td>${n.category}</td>
            <td>${n.title}</td>
            <td><span class="badge ${n.priority.toLowerCase()}">${n.priority}</span></td>
            <td><a class="btn-link" href="notice_detail.html?id=${n.notice_id}">View</a></td>
        </tr>`;
    });
});
</script>
<script>
fetch("api/get_session.php")
  .then(res => res.json())
  .then(data => {
    if (!data.logged_in) {
        window.location.href = "login.html";
        return;
    }

    document.querySelector(".top-bar").innerHTML =
        `Welcome, ${data.username}`;
  });
</script>


</body>
</html>

